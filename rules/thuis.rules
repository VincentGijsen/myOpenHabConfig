import org.openhab.core.library.types.*
import org.openhab.core.persistence.*
import org.openhab.model.script.actions.*
import java.lang.Math.*


rule "BedLight"
	when
		Item DimmedBedLight received command
	then
	
		var Number percent = 0
	
		if(DimmedBedLight.state instanceof DecimalType) percent = DimmedBedLight.state as DecimalType 
			
		if(receivedCommand==INCREASE) percent = percent + 5
		if(receivedCommand==DECREASE) percent = percent - 5
		if(receivedCommand==OFF) percent = 0
		
		if(percent<0)   percent = 0
		if(percent>100) percent = 100
		
		
		//we scale decimally, not hexadicimal!
		val Number scale = Math::floor( percent.floatValue * 1.27).intValue
		sendCommand(Msp, "LEDC1" + "\u0004" +  String::format("%c", scale) +"\n")
		postUpdate(DimmedBedLight, percent);
end

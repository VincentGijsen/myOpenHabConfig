	
var String MspUpdate = ""

var Boolean inPackage = false


rule "MSP on update"
	when 
		Item Msp received update
	then
		//Every package starts with [ (this did i determine myserlf :)
		
		if(Msp.state.toString.trim.notBlank){
	    		MspUpdate = MspUpdate + Msp.state.toString.trim
	    		inPackage= true;

				if (MspUpdate.substring(0,1).equals("r")) {
					println("Received remote command: " + MspUpdate)
					val channel = MspUpdate.substring(1,2)
					val state = MspUpdate.substring(2,3)
					
					if(channel.equals("D"))
					{
						if(state.equals("0")) callScript("work");
						if(state.equals("1")) callScript("sleep");
						
					} 
					if(channel.equals("C"))
					{
						if(state.equals("0")) callScript("off");
						if(state.equals("1")) callScript("movie");
						
					} 
				}
				else if (MspUpdate.substring(0,1).equals("c")){
					println("received Temperature: " + MspUpdate)
				}
				else
				{
					println("unknown package: " + MspUpdate);
				}
				MspUpdate = ""
				
		  }
end
